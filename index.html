<!DOCTYPE html>
<html lang="en">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <meta charset="UTF-8">
  <title>CLOUD GROUPE 7 FRONT</title>
</head>

<body>
  <div class="col-12" style="background: coral;">
    <h1 style="background: coral;" class="text-center">InstaMilligram</h1>
  </div>


  <form method="post" class="needs-validation  border border-danger" class="" id="needs-validation" novalidate>
    <div class="row">
      <div class="col-md-3 mb-3">
        <label for="firstname">First name</label>
        <input type="text" class="form-control" id="firstname" name="firstname" placeholder="First name" required>
        <div class="valid-feedback">
          Looks good!
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <label for="lastname">Last name</label>
        <input type="text" class="form-control" id="lastname" name="lastname" placeholder="Last name" required>
        <div class="valid-feedback">
          Looks good!
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <label for="url">Url</label>
        <input type="text" class="form-control" id="url" placeholder="url" name="url" required>
        <div class="valid-feedback">
          Looks good!
        </div>
      </div>
      <!--div class="custom-file">
        <input type="file" class="custom-file-input" id="customFile">
        <label class="custom-file-label" for="customFile">Choose file</label>
      </div-->
      <button class="btn btn-outline-info btn-sm col-md-3 mb-3" type="button" onclick="sendData();">send image</button>
    </div>
    
  </form>

  <script type="text/javascript">
    (function () {
      'use strict';
      window.addEventListener('load', function () {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function (form) {
          form.addEventListener('submit', function (event) {
            if (form.checkValidity() === false) {
              event.preventDefault();
              event.stopPropagation();
            } else {
              sendData();
            }
            form.classList.add('was-validated');
          }, false);
        });
      }, false);
    })();
  </script>

  <script type="text/javascript">

    function sendData() {
      const formData = document.getElementById('needs-validation');

      const body = JSON.stringify({
        firstname: formData.firstname.value,
        lastname: formData.lastname.value,
        url: formData.url.value
      });

      var headers = new Headers();
      headers.append("Content-Type", "application/json");

      var requestOptions = {
        method: 'POST',
        headers,
        body,
        mode:'cors'
      };

      fetch("https://cloud-groupe-7-api.herokuapp.com/add", requestOptions)
        .then(res => res.text())
        .then(res => alert(res))
        .catch(e => alert(e));
    }
  </script>
  <div className="row text-center">
    <h1 style="background: pink;" class="text-center">ICI LISTE DES IMAGES</h1>
    <script type="text/javascript">
      const headers = new Headers();
      const getInit = {
        method: 'GET',
        headers,
      };

      const bodyElement = document.body;
      const dataDiv = document.createElement('div');
      dataDiv.className = 'row text-center';

      fetch('https://cloud-groupe-7-api.herokuapp.com/images', getInit)
        .then((response) => {
          return response.json();
        })
        .then((res) => {
          //document.write('<h1 style="background: coral;" className="text-center">le formulaire sa mere</h1><div className="row text-center"><div className="col-12" style="background: coral;">formulaire </div> </div><h1 style="background: pink;" className="text-center">ICI LISTE DES IMAGES</h1>');
          for (let i = 0; i < res.length; i++) {

            //console.log(dataDiv);
            const leftDiv = document.createElement('div');
            leftDiv.className = "col-2";
            
            leftDiv.textContent = 'poster par: \"' + res[i]["lastname"] + ' ' + res[i]["firstname"] + '\"'

            const middleDiv = document.createElement('div');
            middleDiv.className = "col-8"
            middleDiv.style.background = 'pink';

            const image = document.createElement('img');
            image.alt = 'image poster par:' + res[i]["firstname"];
            image.src = res[i]["url"];
            middleDiv.appendChild(image);

            const rightDiv = document.createElement('div');
            rightDiv.className = "col-2";
            

            dataDiv.appendChild(leftDiv);
            dataDiv.appendChild(middleDiv);
            dataDiv.appendChild(rightDiv);
            bodyElement.appendChild(dataDiv);
          }
          console.log(res);
        })
        .catch((e) => {
          console.log(e);
          const leftDiv = document.createElement('div');
          leftDiv.className = "col-2";
          leftDiv.style.background = 'aqua';

          const middleDiv = document.createElement('div');
          middleDiv.className = "col-8"
          middleDiv.style.background = 'red';
          middleDiv.textContent = 'Error: ' + e

          const rightDiv = document.createElement('div');
          rightDiv.className = "col-2";
          rightDiv.style.background = 'aqua';

          dataDiv.appendChild(leftDiv);
          dataDiv.appendChild(middleDiv);
          dataDiv.appendChild(rightDiv);
          bodyElement.appendChild(dataDiv);
        });
    /*.then(function(myBlob) {
                                  var objectURL = URL.createObjectURL(myBlob);
                                  myImage.src = objectURL;
                              });*/
    </script>
  </div>
</body>

</html>